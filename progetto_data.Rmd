---
title: "Progetto_data.mining"
author: "Tommaso Di Vincenzo"
date: "16 aprile 2018"
output: word_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
rm(list=ls())
library(tm)
library(SnowballC)
library(wordcloud)
library(cluster)
library(fpc)
```


Innanzi tutto creo un corpus di documenti:
```{r}
docs <- Corpus(DirSource('C:\\Users\\Livia Mattei\\Desktop\\Data Mining\\Lavoro_Esame\\business\\business'))
summary(docs)
```

Tolgo prima di tuttoi trattini alti che, altrimenti, togliendoli con il comando predefinito, attaccherebbero le parole
```{r}
toSpace <- content_transformer(function(x, pattern) { return (gsub(pattern, " ", x))}) 
docs <- tm_map(docs, toSpace, '-')
```

puisco i testi con i comandi predefiniti
```{r}
writeLines(as.character(docs[[40]]))
docs <- tm_map(docs, removePunctuation)
docs <- tm_map(docs, removeNumbers)
docs <- tm_map(docs, content_transformer(tolower))
writeLines(as.character(docs[[40]]))
```

faccio stopping e steming e strippo gli apzi vuoti
```{r}
docs <- tm_map(docs, removeWords, c(stopwords("english"), 'will'))
docs <- tm_map(docs, stemDocument)
docs <- tm_map(docs, stripWhitespace)
```

Modifico le parole (es. said) che le metto al presente!
```{r}
docs <- tm_map(docs, content_transformer(gsub),
               pattern = "said", replacement = "say")
```

Creo la Document-Term matrix attuo una prima valutazione delle frequenze di appirizione delle parole:
```{r}
writeLines(as.character(docs[[40]]))
dtm <- DocumentTermMatrix(docs)
inspect(dtm)
freq <- colSums(as.matrix(dtm))
ord <- order(freq, decreasing=T)
freq[head(ord)]
freq[tail(ord)]
```

Creo una nuova dtm dove faccio una selezione della frequenza e delle lunghezza dei termini che vi entrano:
```{r}
docs <-  tm_map(docs, removeWords, c('also','â£m'))
dtmr <-DocumentTermMatrix(docs, control=list(wordLengths=c(4, 20), bounds = list(global = c(3,510))))
inspect(dtmr)
freqr=colSums(as.matrix(dtmr))
ordr=order(freqr, decreasing = T)
freqr[head(ordr)]
freqr[tail(ordr)]
```

faccio la wordcloud
```{r}
set.seed(42) #PERCHE??????
pal <- brewer.pal(9, "BuGn")
pal <- pal[-(1:4)]
wordcloud(names(freqr),freqr,min.freq=5,colors=pal, random.order=F)
```

Procedo ora con la clusterizzazione dei testi attravero il metodo delle k-means:
Preliminarmente individuo quel k che minimizza la DEVin media o quello che massimizza la silhouette:
```{r}
#DEVin
dev_in=c()
for (k in 1:15){
km = kmeans(as.matrix(dtmr), k)   
dev_in[k]=km$tot.withinss
}

plot(1:15, dev_in, type='b')

#Sil
d <- dist(dtmr)
head(d)
v_sil=c()
for (i in 2:13){
  km = kmeans(as.matrix(dtmr), i)
  sil =silhouette(km$cluster, d)
  s.sil <- summary(sil)
  v_sil[i-1]=s.sil$avg.width
  }

plot(1:12, v_sil, type='b')
```
Scelgo k=7 poichè è il migior trade-off tra una DEVin bassa ed un'alta silhouette media!


```{r}
km = kmeans(dtmr, 7)
dtmr$clustering = km$cluster
```

divido in gruppi
```{r}
gr1 = as.matrix(dtmr[which(dtmr$clustering==1),])
gr2 = as.matrix(dtmr[which(dtmr$clustering==2),])
gr3 = as.matrix(dtmr[which(dtmr$clustering==3),])
gr4 = as.matrix(dtmr[which(dtmr$clustering==4),])
gr5 = as.matrix(dtmr[which(dtmr$clustering==5),])
gr6 = as.matrix(dtmr[which(dtmr$clustering==6),])
gr7 = as.matrix(dtmr[which(dtmr$clustering==7),])
```

faccio le wordscluods dei 7 gruppi
```{r}
set.seed(42)
freq1=colSums(gr1)
wordcloud(names(freq1),freqr,min.freq=30,colors=brewer.pal(6,"Dark2"))

freq2=colSums(gr2)
wordcloud(names(freq2),freqr,min.freq=30,colors=brewer.pal(6,"Dark2"))

freq3=colSums(gr3)
wordcloud(names(freq3),freqr,min.freq=30,colors=brewer.pal(6,"Dark2"))

freq4=colSums(gr4)
wordcloud(names(freq4),freqr,min.freq=30,colors=brewer.pal(6,"Dark2"))

freq5=colSums(gr5)
wordcloud(names(freq5),freqr,min.freq=30,colors=brewer.pal(6,"Dark2"))

freq6=colSums(gr6)
wordcloud(names(freq6),freqr,min.freq=30,colors=brewer.pal(6,"Dark2"))

freq7=colSums(gr7)
wordcloud(names(freq1),freqr,min.freq=30,colors=brewer.pal(6,"Dark2"))

```

```{r}

```

```{r}

```

